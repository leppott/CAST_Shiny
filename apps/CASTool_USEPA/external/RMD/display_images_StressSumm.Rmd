---
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(results = 'asis', 
							 echo = FALSE, 
							 # warning = FALSE, 
							 # message = FALSE, 
							 fig.align = "center",
							 # dev = "png",
							 # out.height="80%",
							 # out.width="80%" 
							 out.width= 4800 / 5 
							 )
bc_dir <- c("BMI", "FISH", "ALG")
bc_text <- c("Benthic Macroinvertebrates", "Fish", "Algae")
boo_print_nodata <- TRUE
```

```{r figs}

# This notebook lists every `.png` from the folder **foo**,
# sorts so should be in relatively the same order each time.  

# includes caption below each figure using basename

# images 50% (set in opts_chunk).  Can't zoom %
# use 4800/10 

# Set the image directory â€” adjust if needed
# adjust directory based on location of RMD file
## go up 2 directories with dirname()

# loop through each biocomm



for (i in seq_len(length(bc_dir))) {
	img_dir <- file.path(dn_results,
								react_setup_region(),
								sel_targsite(),
								bc_dir[i])
	
	# Print if directory exists
	if (dir.exists(img_dir)) {
		# Section Title
		cat(paste0("### ", bc_text[i], "\n\n"))
	} else {
		if (boo_print_nodata) {
			# Section Title
			cat(paste0("### ", bc_text[i], "\n\n"))
			# no data statement
			cat(paste0("No ", 
						  tolower(bc_text[i]), 
						  " data available.\n\n"))
		}## IF ~ boo_print_nodata
	}## IF ~ dir.exists
		
	# Find PNG files (non-recursive). 
	# pattern = "\\.png$"
	# ignore.case = TRUE to allow ".PNG"
	png_all <- list.files(
	  path = img_dir,
	  pattern = "\\.png$",
	  full.names = TRUE,
	  recursive = TRUE,
	  ignore.case = TRUE
	)
	
	# Exclude those in "_WoE" directory
	pat_woe <- paste0("(^|[\\/])_WoE([\\/]|$)")
	png_no_woe <- png_all[!grepl(pat_woe, png_all)]
	
	# Sort for stable order
	png_files <- sort(normalizePath(png_no_woe))
	## directory names only
	png_dirs <- basename(dirname(png_files))
	## convert to labels
	png_dirs_labs <- data_stressInfo[
		match(png_dirs, data_stressInfo$StdParamName),
		"Label"]
	## clean up (same as CASTfxn BMI.rmd)
	png_dirs_labs <- sub("(mg/l)", 
								"mg/L", 
								png_dirs_labs)
   png_dirs_labs <- sub("(PCT)", 
   							"%", 
   							png_dirs_labs)
   png_dirs_labs <- sub("(u)g/m3", 
   							htmltools::HTML("\u00b5"), 
   							png_dirs_labs)
	
	# # output images as vector
	# knitr::include_graphics(png_files)
	fig_caps <- basename(png_files)
	
	for (j in seq_len(length(png_files))) {
		# section
		if (j == 1) {
			# 1st, always include
			cat(paste0("#### ", png_dirs_labs[j], "\n\n"))
		} else if (png_dirs_labs[j] != png_dirs_labs[j-1]) {
			# if different
			cat(paste0("#### ", png_dirs_labs[j], "\n\n"))
		}## IF ~ dir names
		# BMI.rmd uses html code but should be similar
		# cat(paste0("<br><h4><strong><em>", stressLabel, "</em></strong></h4>"))
		
		# image 
		# (html works, include_graphics doesn't inside loop)
		cat(paste0("<img src='", png_files[j], "'><br>"))
		
		# caption
		cat(paste0("\n", fig_caps[j], "\n\n"))
	}## FOR ~ j
	
}## FOR ~ i

```
